<metal:block define-macro="issue_search_results"
             xmlns:tal="http://xml.zope.org/namespaces/tal"
             xmlns:metal="http://xml.zope.org/namespaces/metal"
             xmlns:i18n="http://xml.zope.org/namespaces/i18n"
             i18n:domain="Poi">

  <metal:block define-slot="rss-button">
    <div tal:condition="rssQueryString | nothing" class="issue-search-rss">
      <a href="" tal:attributes="href string:${here/absolute_url}/poi-issue-search-rss.xml?${rssQueryString}">
        <img i18n:attributes="title title_rss_feed; alt label_rss_feed;"
             tal:attributes="src string:$portal_url/rss.gif"
             src="rss.gif"
             alt="RSS Feed"
             title="RSS feed of these search results" />
      </a>
    </div>
  </metal:block>

  <metal:block define-slot="intro-text" />

   <table class="listing issue-search-results"
       tal:define="states context/getIssueWorkflowStates;
                  activeStates issuefolder/getActiveStates;
                  trackerUrl context/absolute_url;
                  issueQueryString python:'%s/poi_issue_search?state=%s' %
                    (trackerUrl, '&amp;state='.join(activeStates),);
                  pas_member context/@@pas_member;
                  can_edit python:checkPermission('Modify portal content', here);
                  releases context/getReleasesVocab;"
       tal:condition="nocall:issues">
       <thead>
      <tr>
        <th i18n:translate="listingheader_number">#</th>
        <th i18n:translate="listingheader_title">Title</th>
        <th i18n:translate="listingheader_release"
            tal:condition="here/isUsingReleases">Target</th>
        <th i18n:translate="listingheader_area">Area</th>
        <th i18n:translate="listingheader_type">Type</th>
        <th i18n:translate="listingheader_severity">Severity</th>
        <th i18n:translate="listingheader_responsible">Responsible</th>
        <th i18n:translate="listingheader_tags">Tags</th>
        <th i18n:translate="listingheader_state">State</th>
      </tr>
    </thead>
       <tbody>
           <tal:issues repeat="raw_item issues">
               <tr tal:define="item python:raw_item.getObject()">
                   <td tal:content="item/getId">
                   </td>
                   <td>
                       <a tal:attributes="href  raw_item/getURL;
                                          title item/Description;"
                          tal:content="item/Title" />
                   </td>
                   <td tal:condition="here/isUsingReleases"
                       tal:define="release item/target_release"
                    >
                       <a tal:define="releases here/getReleasesVocab"
                          tal:attributes="href string:${issueQueryString}&amp;targetRelease=${release};"
                          tal:content="python:release if release else ''" />
                       <div tal:condition="python:item.target_release == '(UNASSIGNED)'"
		                    style="text-align:center">&#8212;</div>
                   </td>
                   <td><a tal:content="python:item.area"
                          tal:attributes="href string:${issueQueryString}&amp;area=${item/area};"
                          tal:on-error="item/area"/>
                   </td>

                   <td><a tal:content="python:item.issue_type"
                          tal:attributes="href string:${issueQueryString}&amp;issueType=${item/issue_type};"
                          tal:on-error="item/issue_type" />
                   </td>
		           <td>
			         <a tal:condition="item/severity"
			            tal:content="item/severity"
			            tal:attributes="href string:${issueQueryString}&amp;severity=${item/severity};" />
			       </td>
                   <td>
                      <a tal:condition="python:item.assignee != '(UNASSIGNED)'"
                         tal:define="manager python:pas_member.info(item.assignee)"
                         tal:attributes="href string:${issueQueryString}&amp;responsible=${item/assignee};"
                         tal:content="manager/name_or_id" />
                       <div tal:condition="python:item.assignee == '(UNASSIGNED)'"
                            style="text-align:center">&#8212;</div>
                   </td>
                   <td tal:content="python:', '.join(item.subject) if item.subject else ''" />
                   <td tal:define="review_state python:item.getReviewState()">
                       <a tal:content="python:review_state['title']"
                          tal:attributes="href string:${here/absolute_url}/poi_issue_search?state=${review_state/state};
                                          class string:issue-${review_state/state}"
                          i18n:translate="" i18n:domain="plone" />
                   </td>
               </tr>
           </tal:issues>
       </tbody>
   </table>

  <metal:block define-slot="footer" />

</metal:block>
